@page "/"
@page "/dashboard"

@using tohdotnetcore.domain
@inject IHeroService HeroService
@inject MessageState MessageState
<h3>Top Heroes</h3>
@if (heros == null)
{
    <p><em>Loading...</em></p>
}
else
{
    <div class="grid grid-pad">
        @foreach (var hero in heros)
        {
            <a href="/detail/@hero.Id" class="col-1-4">
                <div class="module hero">
                    <h4>@hero.Name</h4>
                </div>
            </a>
        }
    </div>
}
<br />

<div style="margin-top:300px; width: 200px">
    <BlazoredTypeahead SearchMethod="@SearchHeros"
                       @bind-Value="@SelectedHero"
                       Placeholder="Search by name...">
        <SelectedTemplate Context="hero">
            @hero.Name
        </SelectedTemplate>
        <ResultTemplate Context="hero">
            @hero.Name
        </ResultTemplate>
    </BlazoredTypeahead>
</div>

@code {
    List<Hero> heros;

    protected override async Task OnInitializedAsync()
    {
        MessageState.NotifyStateHasChanged = StateHasChanged;
        heroResults = new List<Hero>();
        heros = await HeroService.GetHeros();
        MessageState.AddMesage("Hero Service: fetched heros");
    }

    private Hero SelectedHero;

    [Parameter] public List<Hero> heroResults { get; set; }

    private async Task<IEnumerable<Hero>> SearchHeros(string searchText)
    {
        try
        {
            return await HeroService.SearchHeros(searchText);
        }
        catch
        {
            MessageState.AddMesage("Hero Service: Exception");
        }
            return new List<Hero>();
    }
}